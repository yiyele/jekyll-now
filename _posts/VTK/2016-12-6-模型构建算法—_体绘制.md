---
layout: post
title: VTK之模型构建算法-体绘制 
category: VTK
---

# 算法简介


体绘制的算法有很多，在这里我就简单的介绍其中一种-光线投射法。在介绍光线投射法之前，我们得先了解一点，在光纤投射法中有个基本的单位-体素。关于体素的介绍，网上有很多，在这里我就简单的介绍一下我的看法。首先，我们得明确一点，这里的体素就是我们在光线投射法中的基本组成单位。它具有颜色和不透明度两种属性。具体的作用我将在下文中介绍。<br/>
1.对数据进行分类。我们知道进行体绘制的对象是三维体数据，体数据的来源可以来自连续的图片，例如ct图，医学图像一般的格式为DICOM。由于人体组织器官复杂，我们在构建模型时，需要区分。所有在构建模型前，需要分类。这里常见的分类方法就是阈值法。这里就不做多介绍了。ok，分类后，我们可以根据分类的结果给每类数据中的各个体素赋予不同的颜色值和不透明度值。以作为光线投射法进行采样时进行采样点颜色和不透明度插值的依据。<br/>
2.体素的构建，这里我先简单介绍一下，在我们读入图片后，由于图片都是连续的，所以我们可以在连续的两个图片中构建体素。这样在每两个图片中，就有许多的体素填充。
3.颜色赋值。由于我们读入的图片，大多都是处理过或者本身就是灰度图，所以我们需要对不同的组织赋予一个伪彩色。这样在划分体素时，在不同分类中，赋予的颜色也就不一样。<br/>
4.在上面的工作都完成后，剩下的就是图片合成工作了。其实我们在电脑屏幕上看到的就是一个二维的图形，ok，确认这点后，我们在把三维模型显示的时候，主要就是显示二维图形。这里，光线投射法的思想就是这样，首先，我们假设从视点所在位置发出无数条射线，这些射线经过我们上面构建的体素模型，在这一步后，我们还是不知道怎么显示图像，因为光线是连续的，我们不好处理，所以我们取一个步长，分别对每个光线做这个步长的取样。ok，取样后，我们利用三次线性插值求得这个点的相关信息，颜色，不透明度等。然后我们把这个取样的结果和下次的取样结果进行累加。当然这里的累加，并不是简单的累加，因为这里图像的显示，你要考虑不透明度和颜色，所以c=c1(1-a2)+c2*a2.这里的c1是前一个采样点的颜色，c2是下一个采样点的颜色，a2是下一个采样点的不透明度。这样一直累加下去，一直到穿越体数据。最后的结果就是显现在屏幕的结果。<br/>

# 算法代码

算法的具体代码我就不在附上了，不过网上有很多用vtk实现的代码，大家可以去参考。

# 光线投射法

光线投射法是一种体绘制的算法，能够完全的呈现模型的内部信息。但是它的缺点也很明显，计算量大，每次转动视角时，都需要重新的绘制，比较麻烦。

